{% extends 'base.html' %} {% block title %} Doctor {{ translate('Dashboard') }}
{% endblock %} {% block body %}

<!-- Breadcrumb -->
<div class="breadcrumb-bar">
  <div class="container-fluid">
    <div class="row align-items-center">
      <div class="col-md-12 col-12">
        <nav aria-label="breadcrumb" class="page-breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="#">Home</a></li>
            <li class="breadcrumb-item active" aria-current="page">
              Dashboard
            </li>
          </ol>
        </nav>
        <h2 class="breadcrumb-title">Dashboard</h2>
      </div>
    </div>
  </div>
</div>
<!-- /Breadcrumb -->

<!-- Page Content -->
<div class="content">
  <div class="container-fluid">
    <div class="row">
      <!-- Profile Sidebar -->
      <div class="col-md-5 col-lg-4 col-xl-3 theiaStickySidebar">
        {% block sidebar %} {% include 'base-patient-side.html' %} {% endblock
        %}
      </div>
      <!-- / Profile Sidebar -->
      <div class="col-md-7 col-lg-8 col-xl-9">
        <div class="row justify-content-center">
          <div class="col-md-5 card card-calender">
            <div class="calendar" id="table">
              <div class="cal-header">
                <div class="month" id="month-header"></div>
                <div class="buttons">
                  <button class="icon" onclick="prevWeek()" title="last_week">
                    <i class="fas fa-chevron-left"></i>
                  </button>
                  <button class="icon" onclick="nextWeek()" title="next_week">
                    <i class="fas fa-chevron-right"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
          <div
            class="col-md-7 card p-4 patient-card"
            style="padding-bottom: 0 !important"
          >
            <div class="d-flex justify-content-between">
              <div>
                <h3>Hello, {{current_user.name.split()[0]}}!</h3>
                <p>Have a nice day</p>
                <span>Don't forget to keep your info updated</span>

              </div>
              <img src="../static/img/chief.png" style="width: 150px" />
            </div>
          </div>
        </div>

          <div class="col-md-3 justify-content-center card py-4 p-2 m-2 text-center" style="border: 1px solid #056ad77a; box-shadow: #056ad75e 0px 3px 8px;" type="button" data-toggle="tooltip" data-placement="right" title="{{ appointment.date }} {{ appointment.time_range }}">
            {% set base_path = 'static/images/doctors/' %}
              <div class="booking-doc-img" style="border: 2px double #007bffb7; border-radius: 40px; width: 50%; margin: auto;">
                <img

                  src="{{base_path ~ current_user.photo}}"
                  alt="Doctor's photo"
                  width="50"
                  height="50"
                />
              </div>
              <div>
                <p class="mb-1">
                  Dr. {{ appointment.doctor_name }}
                </p>
                <div class="text-muted">
                  {{ appointment.doctor_specialization }}
                </div>
                <span class="text-secondary">{{ appointment.date }}</span>
                    <p class="mb-2">
                      <i class="far fa-clock"></i> {{ appointment.time_range }}
                      - {{ appointment.duration }}
                    </p>
              </div>

          </div>
          <div class="card col-md-12 row py-3 mt-4" style="flex-direction: row!important">
          <div class="col-md-6 pl-2">
            {% if appointment %}

            {% if prescriptions %}
            <div class="row flex-wrap  align-items-center ">

              <div class="col-md-12 card-header border-0 pb-2"><h4>Treatment</h4></div>
              {% for prescription in prescriptions %}
              <div
                class="col-md-10 shadow-sm p-2 pl-4 treatment-card"

              >
                <div class="d-flex justify-content-start align-items-center">
                  <div
                    class="d-inline-block text-center mr-2 mb-2 px-2"
                    style="
                      background-color: rgb(187, 233, 248);
                      color: rgb(4, 179, 238);
                      border-radius: 50%;
                    "
                  >
                    <i class="fas fa-pills"></i>
                  </div>
                  <div>
                    <h5 class="text-muted mb-0">{{ prescription.name }}</h5>

                    <p class="text-muted mb-0">
                      {{ prescription.quantity }} :{{ prescription.times_of_day
                      | join(', ') }}
                    </p>
                  </div>
                </div>
              </div>

              {% endfor %} {% if show_more_button %}
              <div
                class="col-md-12 d-flex flex-wrap justify-content-center align-items-center"
              >
                <a
                  href="{{ url_for('appointment_History') }}"
                  class="icon-container"
                  ><i class="fas fa-angle-double-down"></i
                ></a>
              </div>
              {% endif %}
              {% endif %}
            </div>
          </div>

          <div class="col-md-6 lab-card">

              <div class="card-header border-0 d-flex justify-content-between">
                <h4>Patient Reports</h4>
                <button
                  type="button"
                  class="bg-none py-2"
                  style="
                    border: 1px solid lightgrey;
                    color: grey;
                    border-radius: 10px;
                  "
                  data-toggle="modal"
                  data-target="#exampleModal"
                >
                  <i class="fas fa-cloud-upload-alt"></i>
                </button>
              </div>
              <div class="card-body row">
                <div class="col-md-6">
                  <h5>Lab</h5>
                  <div
                    class="d-flex flex-wrap justify-content-between align-items-center"
                  >
                    {% if patient_history %} {% set counter = 1 %} {% for
                    history in patient_history %} {% if history.file_link and
                    history.type == "Lab" %}
                    <div>
                      <div
                        class="d-inline-block text-center mr-2 mb-2 px-2"
                        style="
                          background-color: rgb(187, 233, 248);
                          color: rgb(4, 179, 238);
                          border-radius: 10px;
                        "
                      >
                        <i class="fas fa-vial"></i>
                      </div>
                      <a
                        href="{{ history.file_link }}"
                        download
                        class="text-decoration-none text-black"
                        style="font-size: 16px"
                      >
                        Lab-{{ counter }}
                        <p class="text-muted mb-0"></p>
                      </a>
                    </div>
                    <div
                      type="button"
                      class="bg-none"
                      style="color: lightblue"
                      data-toggle="tooltip"
                      data-placement="right"
                      title="{{ history.added_by }}"
                    >
                      <i class="fas fa-info" style="font-size: 14px"></i>
                    </div>
                    {% endif %} {% endfor %} {% else %}
                    <p
                      class="w-100 h-100 d-flex justify-content-center align-items-center"
                    >
                      No file attached.
                    </p>
                    {% endif %}
                  </div>
                </div>
                <div class="col-md-6" style="border-left: 1px dashed lightgray">
                  <h5>X-rayes</h5>
                  <div
                    class="d-flex flex-wrap justify-content-between align-items-center"
                  >
                    {% if patient_history %} {% set counter = 1 %} {% for
                    history in patient_history %} {% if history.file_link and
                    history.type == "X_ray" %}
                    <div>
                      <div
                        class="d-inline-block text-center mr-2 mb-2 px-2"
                        style="
                          background-color: rgb(187, 233, 248);
                          color: rgb(4, 179, 238);
                          border-radius: 10px;
                        "
                      >
                        <i class="fas fa-x-ray"></i>
                      </div>
                      <a
                        href="{{ history.file_link }}"
                        download
                        class="text-decoration-none text-black"
                        style="font-size: 16px"
                      >
                        X-RAY-{{ counter }}
                        <p class="text-muted mb-0"></p>
                      </a>
                    </div>
                    <div
                      type="button"
                      class="bg-none"
                      style="color: lightblue"
                      data-toggle="tooltip"
                      data-placement="right"
                      title="{{ history.added_by }}"
                    >
                      <i class="fas fa-info" style="font-size: 14px"></i>
                    </div>
                    {% endif %} {% endfor %} {% else %}
                    <p
                      class="w-100 h-100 d-flex justify-content-center align-items-center"
                    >
                      No file attached.
                    </p>
                    {% endif %}
                  </div>
                </div>
              </div>

          </div>
        </div>
            {% endif %}
            <div class="row">
              <div class="col-md-4 col-lg-4 col-xl-4">
                <h3 class="mb-3">
                  <i class="fas fa-hand-point-right"></i> Next appointment
                </h3>

                <div class="Next-appointment-card card shadow-sm p-4">
                  <div>
                    {% if appointment %}
                    <h4 class="text-primary">{{ appointment.date }}</h4>
                    <p class="mb-2">
                      <i class="far fa-clock"></i> {{ appointment.time_range }}
                      - {{ appointment.duration }}
                    </p>
                    <p class="mb-2">
                      <i class="fas fa-map-marker-alt"></i> {{
                      appointment.clinic_address }}
                    </p>
                    <div class="d-flex align-items-center mt-3">
                      <div class="booking-doc-img">
                        <img
                          class="rounded-circle"
                          src="{{base_path ~ current_user.doctor.photo}}"
                          alt="Doctor's photo"
                          width="80"
                          height="80"
                        />
                      </div>
                      <div class="ml-3">
                        <p class="font-weight-bold mb-1">
                          {{ appointment.doctor_name }}
                        </p>
                        <p class="text-muted">
                          {{ appointment.doctor_specialization }}
                        </p>
                      </div>
                    </div>
                    {% else %}
                    <p
                      class="w-100 h-100 d-flex justify-content-center align-items-center text-muted"
                    >
                      No upcoming appointments.
                    </p>
                    {% endif %}
                  </div>
                </div>
              </div>

              <div class="col-md-4 col-lg-4 col-xl-4">
                <h3 class="mb-3">
                  <i class="fas fa-mortar-pestle"></i> Prescription Details
                </h3>
              </div>
              <div class="col-md-4 col-lg-4 col-xl-4">
                <div
                  class="d-flex justify-content-between align-items-center mb-2"
                >
                  <h3><i class="fas fa-file d-inline"></i> Patient files</h3>
                  <button
                    type="button"
                    class="btn btn-primary"
                    data-toggle="modal"
                    data-target="#exampleModal"
                  >
                    <i class="fas fa-cloud-upload-alt"></i>
                  </button>
                </div>

                <div
                  class="Prescription-appointment-card d-flex flex-wrap justify-content-start overflow-auto"
                >
                  {% if patient_history %} {% for history in patient_history %}
                  {% if history.file_link %}
                  <div
                    class="prescription-card shadow-sm rounded bg-light border text-center m-2"
                  >
                    <a
                      href="{{ history.file_link }}"
                      download
                      class="text-decoration-none text-black"
                    >
                      <div class="text-center mb-2">
                        <i class="fas fa-file-medical-alt h1 text-primary"></i>
                      </div>
                      <p class="text-dark font-weight-bold mb-1">
                        <i class="fas fa-location-arrow"></i> {{ history.type }}
                      </p>
                      <p class="text-muted mb-0">
                        <i class="fas fa-user-plus"></i> {{ history.added_by }}
                      </p>
                    </a>
                  </div>
                  {% endif %} {% endfor %} {% else %}
                  <p
                    class="w-100 h-100 d-flex justify-content-center align-items-center"
                  >
                    No file attached.
                  </p>
                  {% endif %}
                </div>
              </div>
            </div>
            <!-- Modal -->
            <div
              class="modal fade"
              id="exampleModal"
              tabindex="-1"
              role="dialog"
              aria-labelledby="exampleModalLabel"
              aria-hidden="true"
            >
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">
                      add attached
                    </h5>
                    <button
                      type="button"
                      class="close"
                      data-dismiss="modal"
                      aria-label="Close"
                    >
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                    <form method="POST" enctype="multipart/form-data">
                      {{ form.hidden_tag() }}

                      <div class="form-group">
                        <label for="details">{{ form.details.label }}</label>
                        {{ form.details(class="form-control") }}
                      </div>

                      <div class="form-group">
                        <label for="type">{{ form.type.label }}</label>
                        {{ form.type(class="form-control") }}
                      </div>

                      <div class="modal-footer">
                        <button
                          type="button"
                          class="btn btn-secondary"
                          data-dismiss="modal"
                        >
                          Close
                        </button>
                        <button type="submit" class="btn btn-primary">
                          Submit
                        </button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-12 col-lg-12 col-xl-12 mt-5">
              <div class="card">
                <div class="card-body pt-0">
                  <div class="user-tabs">
                    <ul
                      class="nav nav-tabs nav-tabs-bottom nav-justified flex-wrap"
                    >
                      <li class="nav-item">
                        <a
                          class="nav-link active"
                          href="#pat_appointments"
                          data-toggle="tab"
                          >next Appointments</a
                        >
                      </li>
                    </ul>
                  </div>
                  <div class="tab-content">
                    <!-- Appointment Tab -->
                    <div
                      id="pat_appointments"
                      class="tab-pane fade show active"
                    >
                      <div class="card card-table mb-0">
                        <div class="card-body">
                          <div class="table-responsive">
                            <table class="table table-hover table-center mb-0">
                              <thead>
                                <tr>
                                  <th>Doctor</th>
                                  <th>Appt Date</th>
                                  <th>Amount</th>
                                  <th>Status</th>
                                  <th class="text-center">Cancelled</th>
                                </tr>
                              </thead>
                              <tbody>
                                {% set confirmed_appointments = [] %}
                                <!-- Initialize an empty list -->
                                {% for appointment in appointments %} {% if
                                appointment.status.name == 'Confirmed' and not
                                appointment.seen %} {% set
                                confirmed_appointments = confirmed_appointments
                                + [appointment] %}
                                <!-- Add appointment to the list if confirmed and unseen -->
                                <tr>
                                  <td>
                                    <h2 class="table-avatar">
                                      <a
                                        href="doctor-profile.html"
                                        class="avatar avatar-sm mr-2"
                                      >
                                        <img
                                          class="avatar-img rounded-circle"
                                          src="{{ appointment.doctor.users.photo }}"
                                          alt="User Image"
                                        />
                                      </a>
                                      <a href="doctor-profile.html"
                                        >{{ appointment.doctor.users.name }}
                                        <span
                                          >{{
                                          appointment.doctor.specialization.specialization_name
                                          }}</span
                                        >
                                      </a>
                                    </h2>
                                  </td>
                                  <td>
                                    {{ appointment.date }}
                                    <span class="d-block text-info"
                                      >{{ appointment.time_range }}</span
                                    >
                                  </td>
                                  <td>${{ appointment.doctor.price }}</td>
                                  <td>
                                    <span
                                      class="badge badge-pill bg-success-light position-relative d-inline"
                                      >{{ appointment.status.name }}</span
                                    >
                                  </td>
                                  <td class="text-right">
                                    <form
                                      action="{{ url_for('cancel_appointment') }}"
                                      method="post"
                                    >
                                      <div class="table-action">
                                        <input
                                          type="hidden"
                                          name="csrf_token"
                                          value="{{ csrf_token() }}"
                                        />
                                        <input
                                          type="hidden"
                                          name="appointment_id"
                                          value="{{ appointment.id }}"
                                        />
                                        <button
                                          type="submit"
                                          class="btn btn-danger"
                                        >
                                          Cancel
                                        </button>
                                      </div>
                                    </form>
                                  </td>
                                </tr>
                                {% endif %} {% endfor %}

                                <!-- Only show "No upcoming appointments." if confirmed_appointments is empty -->
                                {% if confirmed_appointments|length == 1 %}
                                <tr>
                                  <td colspan="5" class="text-center">
                                    No upcoming appointments.
                                  </td>
                                </tr>
                                {% endif %}
                              </tbody>
                            </table>
                          </div>
                        </div>
                      </div>
                    </div>
                    <!-- /Appointment Tab -->
                  </div>
                </div>
              </div>
            </div>

        </div>
      </div>
      <!-- </div> -->
      <!-- /Page Content -->
      {% endblock %}
    </div>
  </div>
</div>
